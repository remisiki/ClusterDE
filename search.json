[{"path":"https://songdongyuan1994.github.io/ClusterDE/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 ClusterDE authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a PBMC dataset","text":"PBMC datasets originally SeuratData. use one (10x Chromium (v3) PBMC1 replicate). filtered lowly epxressed genes save computational time .","code":"# InstallData(\"pbmcsca\") # data(\"pbmcsca\") # pbmc <- pbmcsca[, pbmcsca@meta.data$Method==\"10x Chromium (v3)\" & pbmcsca@meta.data$Experiment == \"pbmc1\"] #  # pbmc <- pbmc[Matrix::rowSums(pbmc@assays$RNA@counts) > 100, ]  # pbmc <- readRDS(url(\"https://figshare.com/ndownloader/files/41486283\")) data(pbmc, package = \"ClusterDE\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"run-the-regular-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the regular Seurat pipeline","title":"Perform ClusterDE on a PBMC dataset","text":"perform default Seurat clustering. Note real data analysis, cell type label usually unknown.  vignette, interested cluster 2 vs 8, approximately represent CD14+/CD16+ monocytes. Please note ClusterDE designed 1 vs 1 comparison. Therefore, users may (1) choose two interested clusters manually based knowledge (2) use two locally closest clusters computation (e.g., BuildClusterTree Seurat).  perform DE test cluster 2 8. subset cluster 2 8 (pbmc_sub).","code":"RNGkind(\"L'Ecuyer-CMRG\") set.seed(123) pbmc <- Seurat::UpdateSeuratObject(pbmc) #> Validating object structure #> Updating object slots #> Ensuring keys are in the proper structure #> Warning: Assay RNA changing from Assay to Assay #> Ensuring keys are in the proper structure #> Ensuring feature names don't have underscores or pipes #> Updating slots in RNA #> Validating object structure for Assay 'RNA' #> Object representation is consistent with the most current Seurat version pbmc <- Seurat::NormalizeData(pbmc) pbmc <- Seurat::FindVariableFeatures(pbmc) pbmc <- Seurat::ScaleData(pbmc) #> Centering and scaling data matrix pbmc <- Seurat::RunPCA(pbmc) #> PC_ 1  #> Positive:  IL32, CCL5, TRBC2, TRAC, CD69, CST7, RORA, CTSW, SPOCK2, ITM2A  #>     GZMM, CD247, TRBC1, C12orf75, IL7R, CD8A, CD2, LDHB, GZMA, CD7  #>     NKG7, CD6, GZMH, CD8B, BCL11B, PRF1, LYAR, LTB, FGFBP2, TCF7  #> Negative:  LYZ, FCN1, CLEC7A, CPVL, SERPINA1, SPI1, S100A9, AIF1, NAMPT, CSTA  #>     CTSS, MAFB, MPEG1, NCF2, VCAN, FGL2, S100A8, TYMP, CST3, LST1  #>     CYBB, CFD, FCER1G, SLC11A1, TGFBI, GRN, CD14, PSAP, SLC7A7, MS4A6A  #> PC_ 2  #> Positive:  RPL10, EEF1A1, TMSB10, RPS2, RPS12, RPL13, RPS18, RPS23, RPLP1, TPT1  #>     RPS8, IL32, S100A4, PFN1, RPLP0, NKG7, ARL4C, HSPA8, CST7, ZFP36L2  #>     ANXA1, CTSW, S100A6, LDHA, CORO1A, CD247, GZMA, CALR, S100A10, GZMM  #> Negative:  NRGN, PF4, SDPR, HIST1H2AC, MAP3K7CL, PPBP, GNG11, GPX1, TUBB1, SPARC  #>     CLU, PGRMC1, FTH1, RGS18, MARCH2, TREML1, HIST1H3H, AP003068.23, NCOA4, ACRBP  #>     TAGLN2, PRKAR2B, CD9, CA2, CMTM5, CTTN, MTURN, TMSB4X, HIST1H2BJ, TSC22D1  #> PC_ 3  #> Positive:  CD79A, HLA-DQA1, MS4A1, LINC00926, IGHM, BANK1, IGHD, TNFRSF13C, HLA-DQB1, CD74  #>     IGKC, HLA-DRA, BLK, CD83, CD37, CD22, ADAM28, JUND, NFKBID, HLA-DRB1  #>     P2RX5, CD79B, VPREB3, IGLC2, FCER2, RPS8, LTB, RPS23, TCOF1, GNG7  #> Negative:  CCL5, TMSB4X, SRGN, NKG7, ACTB, CST7, GZMH, FGFBP2, CTSW, PRF1  #>     GZMA, GZMB, C12orf75, S100A4, ANXA1, KLRD1, NRGN, GNLY, GZMM, IL32  #>     PF4, SDPR, PPBP, MYO1F, CD247, GAPDH, MAP3K7CL, HIST1H2AC, GNG11, TUBB1  #> PC_ 4  #> Positive:  FCGR3A, GZMB, FGFBP2, GZMH, NKG7, HLA-DPA1, PRF1, HLA-DPB1, CST7, GNLY  #>     KLRD1, HLA-DRB1, GZMA, CCL5, SPON2, ADGRG1, CTSW, ZEB2, PRSS23, IFITM2  #>     CCL4, CD74, KLRF1, RHOC, MTSS1, CDKN1C, CD79B, CEP78, HLA-DQA1, CLIC3  #> Negative:  IL7R, LEPROTL1, LTB, RCAN3, MAL, LEF1, TCF7, ZFP36L2, CAMK4, VIM  #>     LDHB, NOSIP, JUNB, SLC2A3, TRABD2A, RGCC, SATB1, TNFAIP3, TMEM123, SOCS3  #>     AQP3, BCL11B, NELL2, TNFRSF25, CD28, PABPC1, DNAJB1, TRAT1, OXNAD1, TRAC  #> PC_ 5  #> Positive:  CDKN1C, HES4, CSF1R, CKB, ZNF703, TCF7L2, CTSL, MS4A7, PAG1, FAM110A  #>     SIGLEC10, LRRC25, FCGR3A, LTB, RNASET2, CDH23, IL7R, RRAS, LINC01272, IFITM3  #>     LST1, LILRB2, PILRA, RHOC, SLC2A6, PECAM1, CAMK1, TAGLN, IFI30, BID  #> Negative:  VCAN, S100A12, S100A8, CD14, CSF3R, ITGAM, CST7, GZMB, MT-CO1, GNLY  #>     KLRD1, PRF1, MS4A6A, GZMH, FGFBP2, CD93, EGR1, NKG7, S100A9, MT-CO3  #>     IER3, THBS1, RNASE6, CLEC4E, MGST1, CTSW, SGK1, GZMA, RP11-1143G9.4, CH17-373J23.1 pbmc <- Seurat::FindNeighbors(pbmc) #> Computing nearest neighbor graph #> Computing SNN pbmc <- Seurat::FindClusters(pbmc, resolution = 0.3) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 3222 #> Number of edges: 108605 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.9363 #> Number of communities: 10 #> Elapsed time: 0 seconds pbmc <- Seurat::RunUMAP(pbmc, dims = 1:10) #> Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric #> To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation' #> This message will be shown once per session #> 20:55:30 UMAP embedding parameters a = 0.9922 b = 1.112 #> 20:55:30 Read 3222 rows and found 10 numeric columns #> 20:55:30 Using Annoy for neighbor search, n_neighbors = 30 #> 20:55:30 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 20:55:31 Writing NN index file to temp file /tmp/Rtmpc6rjew/file140f8158131bf2 #> 20:55:31 Searching Annoy index using 1 thread, search_k = 3000 #> 20:55:31 Annoy recall = 100% #> 20:55:32 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 20:55:33 Initializing from normalized Laplacian + noise (using RSpectra) #> 20:55:33 Commencing optimization for 500 epochs, with 126446 positive edges #> 20:55:33 Using rng type: pcg #> 20:55:36 Optimization finished p1 <- Seurat::DimPlot(pbmc, reduction = \"umap\", label = T) +   ggplot2::ggtitle(\"Clustering result\") +   Seurat::NoLegend() p2 <- Seurat::DimPlot(pbmc, reduction = \"umap\", group.by = \"CellType\", label = T) +   Seurat::NoLegend() p1 + p2 library(Seurat) #> Loading required package: SeuratObject #> Loading required package: sp #>  #> Attaching package: 'SeuratObject' #> The following objects are masked from 'package:base': #>  #>     intersect, t pbmc <- BuildClusterTree(pbmc) PlotClusterTree(pbmc) pbmc_sub <- subset(x = pbmc, idents = c(2, 8)) # Remove genes with zero variance non_zero_genes <- apply(Seurat::GetAssayData(pbmc_sub, layer = \"counts\"), 1, var) != 0 pbmc_sub <- pbmc_sub[non_zero_genes,]  original_markers <- FindMarkers(   pbmc_sub,   ident.1 = 2,   ident.2 = 8,   min.pct = 0,   logfc.threshold = 0 )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"find-degs-using-clusterde","dir":"Articles","previous_headings":"","what":"Find DEGs using ClusterDE","title":"Perform ClusterDE on a PBMC dataset","text":"can use findMarkers() perform null-calibrated post-clustering differential expression. result table sorted contrast scores. compare result naive Seurat pipeline ClusterDE, first visualize top 6 DE genes Seurat. Genes LST1 RPS19 highly expressed two clusters. addition, RPS19 reported stable housekeeping genes several studies. Note mean expression levels LST1 RPS19 two cell types. means good cell type markers. Philosophically speaking, means conditional two clusters obtained clustering algorithm, LST1 RPS19 less likely cell type markers two cell types. contrast, genes ClusterDE LST1 RPS19 anymore.","code":"res <- ClusterDE::findMarkers(pbmc_sub, ident.1 = 2, ident.2 = 8) #> 107 genes have no more than 2 non-zero values; ignore fitting and return all 0s. #> 64.7% of genes are used in correlation modelling. #> 0/1: Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #> 0/1:  #> 0/1: Number of nodes: 453 #> 0/1: Number of edges: 18845 #> 0/1:  #> 0/1: Running Louvain algorithm... #> 0/1: Maximum modularity in 10 random starts: 0.7221 #> 0/1: Number of communities: 2 #> 0/1: Elapsed time: 0 seconds #> 0/1: Normalizing layer: counts #> 0/1: Finding variable features for layer counts #> 0/1: Centering and scaling data matrix #> 0/1: PC_ 1  #> Positive:  RPS19, PFN1, LST1, YBX1, AIF1, IFITM3, RPL8, RPS27, FTL, FCER1G  #>     RPL41, B2M, RNASET2, RPL10, FTH1, NACA, COTL1, HLA-C, FCGR3A, EEF1A1  #>     HLA-B, RPL15, RPL19, TYROBP, RPL7A, CORO1A, TMSB10, SOD1, RPL11, RHOC  #> Negative:  VCAN, S100A8, S100A9, FOS, LYZ, CD14, SLC2A3, S100A12, CSF3R, GPX1  #>     MS4A6A, IRF2BP2, FOSB, ITGAM, RGS2, THBS1, CD36, PPIF, DUSP6, ZFP36L1  #>     IER3, KLF10, CD93, NCF1, SELL, NFKBIA, SGK1, CEBPD, LUCAT1, CYP1B1  #> PC_ 2  #> Positive:  TPT1, RPS13, RPS3A, RPL18A, S100A10, RPS18, GAPDH, RPS23, RPS8, HLA-DRA  #>     RPLP0, RPL3, RPS6, VIM, FCN1, BTF3, RPS2, LYZ, GPX1, RPL6  #>     GRN, RPL37A, EEF1A1, LGALS3, RPS4X, RPL21, RPL30, RPL23A, RPL15, RPS15  #> Negative:  CDKN1C, FCGR3A, CD79B, MTSS1, CTSL, ADA, RNF144B, RHOC, CKB, HES4  #>     PECAM1, PIK3CG, CSF1R, SLC2A6, POU2F2, RRAS, SSH2, IFITM2, C3AR1, MS4A7  #>     FAM126A, TSPAN32, PTPN6, TCF7L2, PKN1, KLF2, SAT1, DRAP1, SOD1, SFMBT2  #> PC_ 3  #> Positive:  HMGB2, IRS2, CLEC2D, S100A12, ZFP36L2, LINC00657, HSPA8, QPCT, TNFSF10, PPP2R5E  #>     BST1, RPS3, NSMCE3, VCAN, RNF144B, JUN, RBP7, CES1, RAB27A, SOX4  #>     RPS8, RGS2, RPL23A, PLBD1, S100A8, YPEL3, LUC7L3, RPL6, LRMP, RPL34  #> Negative:  HLA-DPA1, HLA-DRA, HLA-DPB1, EMP3, APOBEC3A, RGCC, HLA-DRB1, MARCKS, DUSP6, INSIG1  #>     C5AR1, CD74, CTNNB1, HMOX1, HIC1, BHLHE40, XYLT1, CALM2, S100A11, MAFB  #>     TLE3, MARCKSL1, FUCA1, HLA-DQB1, EZR, FCER1G, PPIF, RASGEF1B, CST3, SMAD7  #> PC_ 4  #> Positive:  WDR74, SERPINA1, ACTB, S100A4, FTL, TMSB4X, BCL2A1, FTH1, S100A8, GAPDH  #>     RGS2, S100A9, AP1S2, FOS, S100A12, TYROBP, COTL1, CCDC109B, AIF1, JUNB  #>     S100A11, H1FX, EGR1, CD14, LYZ, SERF2, RBP7, FCER1G, BASP1, NFKBIZ  #> Negative:  ARL4C, DNAJB14, MAP3K8, IL2RG, DDIT4, PNPT1, HLA-DQB1, ANKLE2, APOL6, NSMCE3  #>     SMAD7, RBM17, HLA-DPB1, MRE11A, MPRIP, CNIH1, TNFSF12, DDX6, ZCCHC11, NKG7  #>     C1orf56, DDHD1, HLA-DPA1, KMT2A, RUNX3, ISG20L2, MGAT4A, KCNQ1, RP11-796E2.4, ARHGAP15  #> PC_ 5  #> Positive:  HLA-DMA, FAM26F, MRPS36, CD74, HLA-DRB1, RGS19, HLA-DQB1, HLA-DMB, CAMK1, MT2A  #>     HIGD2A, SERTAD3, CHCHD10, PPCDC, FAM49A, LILRA5, NABP1, CPVL, MAT2A, KYNU  #>     PID1, TEX261, CST3, IRF7, SNIP1, RPS2, STK26, DNAJC18, CAT, GALNS  #> Negative:  CD63, ZBTB7A, LINC00969, LINC00657, SSBP4, MGAT4A, ZNF654, VIM, ITGAL, ID2  #>     VEGFA, FBXO7, PRPF38B, CEBPB, YY1, CSTB, SNRPA1, HSD17B4, PAG1, PDP1  #>     TFRC, NPEPPS, COMMD2, PLEC, RAB22A, ZDHHC17, BRWD1, DNASE2, GABARAPL1, TLR2 #> 0/1: Computing nearest neighbor graph #> 0/1: Computing SNN head(res) #> # A tibble: 6 × 3 #>   gene        cs record #>   <chr>    <dbl>  <dbl> #> 1 CDKN1C    39.9      1 #> 2 CD79B     38.6      1 #> 3 FCGR3A    33.8      1 #> 4 CKB       32.3      1 #> 5 SIGLEC10  24.4      1 #> 6 MTSS1     23.8      1 FeaturePlot(pbmc[, pbmc$seurat_clusters %in% c(2, 8)], features = c(rownames(original_markers)[1:6]), ncol = 3) FeaturePlot(pbmc[, pbmc$seurat_clusters %in% c(2, 8)], features = c(res$gene[1:6]), ncol = 3)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"customize-null-data-generation","dir":"Articles","previous_headings":"","what":"Customize null data generation","title":"Perform ClusterDE on a PBMC dataset","text":"show ClusterDE generates calculates synthetic null data p-values. synthetic null data first generated based target data (real subset data, pbmc_sub, contains two clusters interested ). can increase number cores (CPUs) speed . Next perform preprocess pipeline null data target data, wrapped calcNullPval(). uses Louvain clustering Seurat adjust resolution two clusters found. can use dimPlot() compare reference (real) dataset synthetic null datasets generated ClusterDE.  extract p-values original data synthetic null data, use ClusterDE “compare” . result table list DEGs ranked contrast scores, also used output findMarkers().","code":"null_data <- ClusterDE::constructNull(pbmc_sub, nCores = 1) #> 107 genes have no more than 2 non-zero values; ignore fitting and return all 0s. #> 64.7% of genes are used in correlation modelling. null_pval <- ClusterDE::calcNullPval(null_data) #> 0/1: Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #> 0/1:  #> 0/1: Number of nodes: 453 #> 0/1: Number of edges: 18061 #> 0/1:  #> 0/1: Running Louvain algorithm... #> 0/1: Maximum modularity in 10 random starts: 0.7460 #> 0/1: Number of communities: 2 #> 0/1: Elapsed time: 0 seconds #> 0/1: Normalizing layer: counts #> 0/1: Finding variable features for layer counts #> 0/1: Centering and scaling data matrix #> 0/1: PC_ 1  #> Positive:  RPS19, AIF1, YBX1, COTL1, FTL, LST1, NACA, PFN1, FTH1, RPL8  #>     HLA-C, RPS27, FCER1G, RPL41, RPL10, TMSB4X, HLA-B, IFITM3, B2M, ARPC3  #>     RPL11, RPL19, TMSB10, IFITM2, EEF1A1, RNASET2, ACTB, RPL15, FCGR3A, CFD  #> Negative:  S100A8, VCAN, S100A9, S100A12, CD14, CSF3R, LYZ, FOS, SLC2A3, NCF1  #>     CYP1B1, MS4A6A, SELL, PTPRE, CCR1, RGS2, SGK1, IRF2BP2, GPX1, HIF1A  #>     RNASE6, IER3, DUSP6, CD36, MGST1, JARID2, CRTAP, PPIF, STAB1, FOSB  #> PC_ 2  #> Positive:  MALAT1, CDKN1C, KLF2, FCGR3A, PECAM1, FAM110A, SLC2A6, POU2F2, CD79B, MTSS1  #>     TCF7L2, RRAS, SIGLEC10, PAG1, CAT, HES4, SLC44A2, RHOC, IFITM2, SNX9  #>     MS4A7, YPEL2, CYTIP, PKN1, LYST, SFMBT2, ADA, PIK3CG, LYL1, WARS  #> Negative:  TPT1, RPS13, GAPDH, VIM, RPS3A, RPL3, LYZ, RPS23, RPL18A, RPS18  #>     RPL28, RPS14, RPS2, HLA-DRA, RPS12, GPX1, RPS6, RPS8, EEF1A1, RPS15  #>     RPL37A, RPL5, RPL23A, FCN1, RPL30, S100A9, RPL10A, RPL37, S100A10, RPL11  #> PC_ 3  #> Positive:  HLA-DRA, HLA-DRB1, HLA-DPB1, HLA-DQB1, EMP3, HLA-DPA1, MARCKS, DUSP6, CD74, APOBEC3A  #>     CPVL, CST3, MARCKSL1, IFI30, HLA-DMB, ISG15, NAAA, CDKN1A, CD300E, GPX1  #>     BHLHE40, HIC1, LGALS3, IFITM3, FUCA1, SRC, LIPA, HLA-DMA, EZR, HMOX1  #> Negative:  HMGB2, IRS2, RGS2, RPL30, BTG1, RPS15A, PIK3IP1, ZFP36L2, RPS3A, HSPA8  #>     RPS27, EGR1, SELL, S100A12, RPS3, PLBD1, JUN, LEPROTL1, C12orf57, SOD2  #>     RPSA, EFCAB2, RPL23A, SLU7, VCAN, ALOX5AP, RPL5, RPS6, TNFSF10, RPS4X  #> PC_ 4  #> Positive:  RPS14, ARPC1B, ATF3, RPL5, DSTYK, KRI1, C12orf76, RPL37, RPL28, RPL19  #>     HIF1AN, DAPP1, TRRAP, CASP7, DCTPP1, AIF1, RPL29, RPS2, IL6R, USP1  #>     RPL10, KIF20B, TMEM18, AACS, RPL41, C5AR1, RPS13, ZBTB14, RPL8, RPS19  #> Negative:  CALM1, SNRK, LYAR, SSBP3, MALAT1, PRPF38B, DDX6, ARL4C, NKG7, ITGB1  #>     TMEM2, KLF10, SRSF7, IMPAD1, TPST2, ABCC3, DNMT1, LINC00969, LINC-PINT, DDIT4  #>     JARID2, MAP3K2, HBEGF, ASH1L, CYTIP, MAP3K8, APOBEC3A, INSIG1, EML4, DDHD1  #> PC_ 5  #> Positive:  UHMK1, CTB-50L17.10, ANKRD9, CEP44, LPAR6, PPM1K, VPS41, TANGO2, C6orf1, INIP  #>     MARCH9, TIMM23B, BBC3, AGPAT5, TAGLN2, CITED2, USP1, NDUFAF4, TMEM107, CLN3  #>     PSMB9, RPL14, BRI3BP, PRPF38B, BLMH, UBE2D4, LYRM5, SMU1, C16orf74, LINC00877  #> Negative:  SLC2A3, ACTB, WDR11, PLAUR, WDFY2, ICAM3, S100A8, ACTG1, PLBD1, S100A9  #>     UNC119, MAFG, WDR62, RBAK, VPS13A, C19orf38, CUX1, S100A12, SRGAP2B, SELL  #>     BAX, MRPL2, VIM, CLEC4E, EMP3, RAB34, PTGER2, GAPDH, ACSL4, HCST #> 0/1: Computing nearest neighbor graph #> 0/1: Computing SNN ClusterDE::dimPlot(pbmc_sub, null_pval$data) #> Warning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by #> 'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment' #> Registered S3 method overwritten by 'scDesign3': #>   method         from   #>   predict.gamlss gamlss #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' original_pval <- original_markers$p_val names(original_pval) <- rownames(original_markers) res <- ClusterDE::callDE(original_pval, null_pval$p) head(res) #> # A tibble: 6 × 3 #>   gene      cs record #>   <chr>  <dbl>  <dbl> #> 1 CDKN1C  33.2      1 #> 2 CD79B   31.4      1 #> 3 FCGR3A  29.7      1 #> 4 HES4    24.1      1 #> 5 PLD4    23.6      1 #> 6 CYFIP2  22.6      1"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"pca-approximation-for-faster-null-data-generation","dir":"Articles","previous_headings":"","what":"PCA approximation for faster null data generation","title":"Perform ClusterDE on a PBMC dataset","text":"robust DEG detection, ClusterDE allows generating multiple null data replicates. increasing number nRep findMarkers(), can create several synthetic null datasets compare original DE markers. generating many null data replicates (nRep) DEG analysis, null data simulation can become time-consuming. ClusterDE provides PCA-based approximation speed process. setting flavour “pca” increasing number threads (nCores) findMarkers(), null datasets generated faster still preserving robustness. record column counts frequency gene identified DEG across null data replicates. higher record value indicates gene consistently called differentially expressed across multiple simulated null datasets. metric helps assess stability reproducibility DE calls. can also visualize genes found ClusterDE multiple replicates PCA approximation.  explicitly construct null data using PCA approximation, can specify usePca = T adjust number PCs changing nPcs constructNull(). returned null_data contain list replicates. can use calcNullPval() preprocess calculate gene p-values replicate. Note PCA approximation used, simulated null data true count matrix, normalization skipped, highly variable genes provided real reference data. show part simulated null replicates UMAP space real data.","code":"res <- ClusterDE::findMarkers(   pbmc_sub,   ident.1 = 2,   ident.2 = 8,   flavour = \"pca\",   nRep = 40,   nCores = 8 ) head(res) #> # A tibble: 6 × 3 #>   gene      cs record #>   <chr>  <dbl>  <dbl> #> 1 CDKN1C  27.9  0.75  #> 2 FCGR3A  27.0  0.75  #> 3 CD79B   25.9  0.625 #> 4 RHOC    23.0  0.75  #> 5 CKB     21.3  0.725 #> 6 TCF7L2  18.8  0.825 FeaturePlot(pbmc[, pbmc$seurat_clusters %in% c(2, 8)], features = c(res$gene[1:6]), ncol = 3) null_data <- ClusterDE::constructNull(pbmc_sub, usePca = T, nCores = 8, nRep = 40, nPcs = 200) #> Contruct PCA #> Construct scDesign3 data #> Fit marginal #> Fit copula #> Generate null data of 40 replicates null_pval <- ClusterDE::calcNullPval(null_data, normalize = F, hvg = Seurat::VariableFeatures(pbmc_sub), nCores = 8) ClusterDE::dimPlot(pbmc_sub, null_pval$data[1:11]) #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics' #> Found more than one class \"dist\" in cache; using the first, from namespace 'spam' #> Also defined by 'BiocGenerics'"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-PBMC.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a PBMC dataset","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Red Hat Enterprise Linux 8.10 (Ootpa) #>  #> Matrix products: default #> BLAS:   /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRblas.so  #> LAPACK: /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRlapack.so;  LAPACK version 3.11.0 #>  #> Random number generation: #>  RNG:     L'Ecuyer-CMRG  #>  Normal:  Inversion  #>  Sample:  Rejection  #>   #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Detroit #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats     graphics  grDevices utils     datasets  methods   base      #>  #> other attached packages: #> [1] Seurat_5.3.1       SeuratObject_5.2.0 sp_2.2-0           future_1.67.0      #> [5] BiocStyle_2.30.0   #>  #> loaded via a namespace (and not attached): #>   [1] RcppAnnoy_0.0.22            splines_4.3.1               #>   [3] later_1.4.4                 bitops_1.0-9                #>   [5] tibble_3.3.0                polyclip_1.10-7             #>   [7] gamlss.data_6.0-7           fastDummies_1.7.5           #>   [9] lifecycle_1.0.4             globals_0.18.0              #>  [11] lattice_0.21-8              MASS_7.3-60                 #>  [13] backports_1.5.0             magrittr_2.0.4              #>  [15] limma_3.58.1                plotly_4.11.0               #>  [17] sass_0.4.10                 rmarkdown_2.30              #>  [19] jquerylib_0.1.4             yaml_2.3.10                 #>  [21] httpuv_1.6.16               otel_0.2.0                  #>  [23] sctransform_0.4.2           askpass_1.2.1               #>  [25] spam_2.11-1                 spatstat.sparse_3.1-0       #>  [27] reticulate_1.44.0           cowplot_1.2.0               #>  [29] pbapply_1.7-4               RColorBrewer_1.1-3          #>  [31] zlibbioc_1.48.2             abind_1.4-8                 #>  [33] Rtsne_0.17                  GenomicRanges_1.54.1        #>  [35] purrr_1.1.0                 presto_1.0.0                #>  [37] BiocGenerics_0.48.1         kde1d_1.1.1                 #>  [39] RCurl_1.98-1.17             GenomeInfoDbData_1.2.11     #>  [41] IRanges_2.36.0              S4Vectors_0.40.2            #>  [43] ggrepel_0.9.6               irlba_2.3.5.1               #>  [45] listenv_0.9.1               spatstat.utils_3.2-0        #>  [47] umap_0.2.10.0               goftest_1.2-3               #>  [49] RSpectra_0.16-2             spatstat.random_3.4-2       #>  [51] fitdistrplus_1.2-4          parallelly_1.45.1           #>  [53] pkgdown_2.2.0               DelayedArray_0.28.0         #>  [55] codetools_0.2-19            tidyselect_1.2.1            #>  [57] farver_2.1.2                randtoolbox_2.0.5           #>  [59] matrixStats_1.5.0           stats4_4.3.1                #>  [61] spatstat.explore_3.5-3      jsonlite_2.0.0              #>  [63] progressr_0.17.0            ggridges_0.5.7              #>  [65] survival_3.5-5              systemfonts_1.3.1           #>  [67] bettermc_1.2.2.9000         tools_4.3.1                 #>  [69] ragg_1.5.0                  ica_1.0-3                   #>  [71] Rcpp_1.1.0                  glue_1.8.0                  #>  [73] SparseArray_1.2.4           gridExtra_2.3               #>  [75] xfun_0.53                   mvnfast_0.2.8               #>  [77] MatrixGenerics_1.14.0       scDesign3_1.7.6             #>  [79] GenomeInfoDb_1.38.8         dplyr_1.1.4                 #>  [81] withr_3.0.2                 BiocManager_1.30.26         #>  [83] fastmap_1.2.0               openssl_2.3.4               #>  [85] digest_0.6.37               gamlss_5.5-0                #>  [87] R6_2.6.1                    mime_0.13                   #>  [89] textshaping_1.0.4           scattermore_1.2             #>  [91] tensor_1.5.1                spatstat.data_3.1-9         #>  [93] utf8_1.2.6                  tidyr_1.3.1                 #>  [95] generics_0.1.4              data.table_1.17.8           #>  [97] S4Arrays_1.2.1              httr_1.4.7                  #>  [99] htmlwidgets_1.6.4           rngWELL_0.10-10             #> [101] uwot_0.2.3                  pkgconfig_2.0.3             #> [103] gtable_0.3.6                lmtest_0.9-40               #> [105] S7_0.2.0                    SingleCellExperiment_1.24.0 #> [107] XVector_0.42.0              htmltools_0.5.8.1           #> [109] dotCall64_1.2               bookdown_0.45               #> [111] Biobase_2.62.0              scales_1.4.0                #> [113] png_0.1-8                   spatstat.univar_3.1-4       #> [115] knitr_1.50                  reshape2_1.4.4              #> [117] checkmate_2.3.3             nlme_3.1-162                #> [119] cachem_1.1.0                zoo_1.8-14                  #> [121] stringr_1.5.2               KernSmooth_2.23-21          #> [123] parallel_4.3.1              miniUI_0.1.2                #> [125] desc_1.4.3                  pillar_1.11.1               #> [127] grid_4.3.1                  vctrs_0.6.5                 #> [129] RANN_2.6.2                  promises_1.4.0              #> [131] xtable_1.8-4                cluster_2.1.4               #> [133] gamlss.dist_6.1-1           evaluate_1.0.5              #> [135] cli_3.6.5                   compiler_4.3.1              #> [137] crayon_1.5.3                rlang_1.1.6                 #> [139] future.apply_1.20.0         labeling_0.4.3              #> [141] mclust_6.1.1                plyr_1.8.9                  #> [143] fs_1.6.6                    stringi_1.8.7               #> [145] viridisLite_0.4.2           deldir_2.0-4                #> [147] assertthat_0.2.1            rvinecopulib_0.7.3.1.0      #> [149] lazyeval_0.2.2              coop_0.6-3                  #> [151] spatstat.geom_3.6-0         Matrix_1.6-5                #> [153] RcppHNSW_0.6.0              patchwork_1.3.2             #> [155] ggplot2_4.0.0               statmod_1.5.1               #> [157] shiny_1.11.1                SummarizedExperiment_1.32.0 #> [159] ROCR_1.0-11                 igraph_2.2.1                #> [161] ClusterDE_0.99.3            bslib_0.9.0                 #> [163] ape_5.8-1"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a cell line dataset","text":"download cell line data set H2228. original data Tian et al., Nature Methods 2019 gold standard benchmarking accuracy clustering. Since data pure cell line, cell types, , course, cell type DE genes. Note: mean variations within one cell line; course , e.g., cell cycle, total UMI, etc. However, variations represent discrete cell groups, essentially means use obtained clusters explain variation.","code":"# sce <- readRDS(url(\"https://figshare.com/ndownloader/files/41395260\")) # cellline <- Seurat::as.Seurat(sce) data(cellline, package = \"ClusterDE\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"run-the-regular-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the regular Seurat pipeline","title":"Perform ClusterDE on a cell line dataset","text":"perform default Seurat clustering. Please note ClusterDE designed 1 vs 1 comparison; therefore, set resolution 0.2 obtain two clusters illustration purpose.  UMAP, two clusters seem dubious. Although expect existence cell types, perform Seurat DE test two clusters, get > 1000 genes FDR < 0.05. means double-dipping introduces huge number discoveries.","code":"RNGkind(\"L'Ecuyer-CMRG\") set.seed(123) cellline <- Seurat::UpdateSeuratObject(cellline) #> Validating object structure #> Updating object slots #> Ensuring keys are in the proper structure #> Updating matrix keys for DimReduc 'PCA' #> Updating matrix keys for DimReduc 'UMAP' #> Ensuring keys are in the proper structure #> Ensuring feature names don't have underscores or pipes #> Updating slots in originalexp #> Updating slots in PCA #> Updating slots in UMAP #> Setting UMAP DimReduc to global #> Validating object structure for Assay 'originalexp' #> Validating object structure for DimReduc 'PCA' #> Validating object structure for DimReduc 'UMAP' #> Object representation is consistent with the most current Seurat version cellline <- Seurat::NormalizeData(cellline) cellline <- Seurat::FindVariableFeatures(cellline) cellline <- Seurat::ScaleData(cellline) #> Centering and scaling data matrix cellline <- Seurat::RunPCA(cellline) #> PC_ 1  #> Positive:  RPS14, RPL18AP3, RPL36, RPS23, RPL28, LRRC75A-AS1, AC079250.1, FTH1, ZFAS1, EEF2  #>     RPL7P9, RPL13A, RPS3AP26, EEF1A1P13, RPS16, RPS23P8, RPL13AP5, RPL29, FTH1P10, RPL13AP25  #>     SNHG5, FTH1P8, RPL4, RPS3AP6, AC064799.1, C6orf48, FTH1P7, C1orf56, RPL7AP6, TMSB4X  #> Negative:  PSMB2, PSMA7, U2AF1, NUDC, RBM8A, CALM1, BUB3, CLIC1, U2AF1L5, XRCC5  #>     VPS29, RBM8B, CACYBP, RPA3, SSBP1, PSMC5, MRPL47, PSMD8, BRIX1, CNIH4  #>     PCMT1, PSMD13, CYC1, PRDX2, SEPT7, S100A11, VDAC3, PSME2P2, ZWINT, HMGB1  #> PC_ 2  #> Positive:  NACA, RPL7AP6, SKP1, UBA52, BTF3, SSR2, RPL7A, ARPC3, RPL9P9, PPIA  #>     PSMD4, EIF1, RPL10, LGALS3BP, RPL10P16, SNRPB2, RPL10P9, S100A11, PPIB, ANXA5  #>     EEF2, PSME1, SSBP1, SSR4, RPL7P9, COPE, BSG, MGST1, VPS28, COPS6  #> Negative:  SIVA1, HNRNPAB, RPL39L, DEK, CDCA5, TMPO, FAM111A, ASF1B, CENPK, ESCO2  #>     BRCA1, H2AFV, RAD51AP1, MT-RNR2, ORC6, CENPX, SNRNP25, FBXO5, RRM1, DIAPH3  #>     USP1, CDCA4, TMEM106C, PGP, LSM4, C21orf58, CENPN, BRI3BP, SGO1, CHAF1A  #> PC_ 3  #> Positive:  RPL13AP5, RPL13AP25, AC024293.1, RPL29, RPSAP19, RPS5, RPL18, RPS3AP26, RPS3AP6, RPL15  #>     RPL28, DRAP1, RPS11, RPL9P9, RPL13AP7, RPS19, DCBLD2, FXYD5, FEN1, SLBP  #>     RPS15, COTL1, RPSA, FLNA, RPL7AP6, RPL36, C1orf21, CPA4, ORC6, RPS16  #> Negative:  SMIM22, TSPAN13, ST14, PERP, CRB3, MT-CO1, SERINC2, ATP1B1, CDH1, F11R  #>     B2M, MT-RNR2, SPINT1, NMB, PLA2G16, SPDEF, CD55, ADGRF1, TSPAN1, LIMA1  #>     ERBB3, ERO1A, ASS1, CDA, ALCAM, SYNGR2, MT-CO2, CDH3, C3, LSR  #> PC_ 4  #> Positive:  IFNGR1, NAMPT, NAP1L1, CPD, LMAN1, CALR, ITGA2, NAMPTP1, ITM2B, RRM1  #>     C3, RHOBTB3, CTHRC1, EEF2, HSD17B11, C1S, IFI16, SMC2, CPE, EPHX1  #>     DST, HLA-DMB, NUCB2, MT-ND6, TMEM45A, BRCA1, CDK5RAP2, HINT1, C1R, FAM111A  #> Negative:  S100A16, TMA7, TIMM8B, PFN1, SLIRP, GPX1, LAMC2, POLR2L, MRPL52, RPS19  #>     CDH1, TOMM40, ATP5MD, HSPE1, NAA10, GPX1P1, RPS16, MRPL12, MCRIP2, PDCD5  #>     RPL18, PLEC, S100A13, RPL36AL, LAD1, MGLL, BOLA2B, MISP, MRPL36, SEC61G  #> PC_ 5  #> Positive:  HINT1, COX5B, TXN, SOD1, NDUFA4, NDUFS6, ATP5PO, ATP5MC3, S100A10, ATP6V0E1  #>     CYB5A, SLIRP, NDUFB4, ATP5MC1, HSPE1, TXNP6, POMP, POLR2L, RPS14, HSPE1P4  #>     RPS15, CBR1, NDUFB3, HSPE1P3, ATP5PD, COX7B, ADGRF1, PSMB9, AC079250.1, NDUFAB1  #> Negative:  BTG1, PPP1R15A, EIF1, JUN, CEBPG, H3F3B, TMEM132A, C6orf48, HIST2H4B, SGK1  #>     KPNA4, PMEPA1, KLF6, CDKN1A, WARS, PEA15, GARS, MAP1LC3B, SNHG12, SERTAD1  #>     LAMC2, EPB41L4A-AS1, NAP1L1, SNHG5, KLF10, SLC7A5, KIF5B, ATP2B1, EIF5, ABL2 #> Warning: Key 'PC_' taken, using 'pca_' instead cellline <- Seurat::FindNeighbors(cellline) #> Computing nearest neighbor graph #> Computing SNN cellline <- Seurat::FindClusters(cellline, resolution = 0.2) #> Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #>  #> Number of nodes: 758 #> Number of edges: 24895 #>  #> Running Louvain algorithm... #> Maximum modularity in 10 random starts: 0.8257 #> Number of communities: 2 #> Elapsed time: 0 seconds cellline <- Seurat::RunUMAP(cellline, dims = 1:10) #> Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric #> To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation' #> This message will be shown once per session #> 20:48:58 UMAP embedding parameters a = 0.9922 b = 1.112 #> 20:48:58 Read 758 rows and found 10 numeric columns #> 20:48:58 Using Annoy for neighbor search, n_neighbors = 30 #> 20:48:58 Building Annoy index with metric = cosine, n_trees = 50 #> 0%   10   20   30   40   50   60   70   80   90   100% #> [----|----|----|----|----|----|----|----|----|----| #> **************************************************| #> 20:48:58 Writing NN index file to temp file /tmp/Rtmp823XBi/file13f8bc2fc15766 #> 20:48:58 Searching Annoy index using 1 thread, search_k = 3000 #> 20:48:58 Annoy recall = 100% #> 20:48:59 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30 #> 20:48:59 Initializing from normalized Laplacian + noise (using RSpectra) #> 20:48:59 Commencing optimization for 500 epochs, with 27914 positive edges #> 20:48:59 Using rng type: pcg #> 20:49:01 Optimization finished Seurat::DimPlot(cellline, reduction = \"umap\") + ggplot2::ggtitle(\"Clustering result\") original_markers <- Seurat::FindMarkers(   cellline,   ident.1 = 0,   ident.2 = 1,   min.pct = 0,   logfc.threshold = 0 ) message(paste0(\"Number of DE gene is \", sum(original_markers$p_val_adj < 0.05))) #> Number of DE gene is 1023"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"find-degs-using-clusterde","dir":"Articles","previous_headings":"","what":"Find DEGs using ClusterDE","title":"Perform ClusterDE on a cell line dataset","text":"can use findMarkers() perform null-calibrated post-clustering differential expression. result table sorted contrast scores. can observe results genes frequency record 0, means detect DE genes. can also visualize distribution contrast scores (diff -log p-values real null). roughly symmetric around 0.","code":"res <- ClusterDE::findMarkers(cellline, ident.1 = 0, ident.2 = 1) #> 1 genes have no more than 2 non-zero values; ignore fitting and return all 0s. #> 98.5% of genes are used in correlation modelling. #> 0/1: Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck #> 0/1:  #> 0/1: Number of nodes: 758 #> 0/1: Number of edges: 29534 #> 0/1:  #> 0/1: Running Louvain algorithm... #> 0/1: Maximum modularity in 10 random starts: 0.7153 #> 0/1: Number of communities: 2 #> 0/1: Elapsed time: 0 seconds #> 0/1: Normalizing layer: counts #> 0/1: Finding variable features for layer counts #> 0/1: Centering and scaling data matrix #> 0/1: PC_ 1  #> Positive:  PSMB2, CALM1, U2AF1, NUCKS1, RBM8A, CNIH4, PSMA7, MRPL47, VPS29, RPA3  #>     XRCC5, U2AF1L5, CLIC1, HMGB1, NDUFA8, PTMAP2, BUB3, SEPT7, RANBP1, EIF5  #>     CACYBP, ATP5PO, NDUFAB1, SNRPF, TXN, CYC1, NME1, SSBP1, NUDC, RBM8B  #> Negative:  RPL34, LRRC75A-AS1, RPL23, AC079250.1, RPS3AP26, ZFAS1, RPL7P9, RPL13A, RPL28, EEF2  #>     RPL4, RPS6, RPL10, RPS16, FTH1, SNHG5, RPS3AP6, RPL7AP6, RPL10P16, RPL13AP5  #>     RPL13AP25, RPS11, CEBPD, RPS3, RPL9P9, FTH1P10, TMSB4X, RPL10P9, FTH1P8, FTH1P7  #> PC_ 2  #> Positive:  SSR2, BTF3, RPL7AP6, UBA52, PSMD4, SKP1, RPL10P16, RPL7A, RPL10, RPL9P9  #>     EEF2, BSG, RPL10P9, COPE, APEX1, VPS28, ANXA5, EIF1, PPIB, RPL7AP30  #>     ARPC3, S100A11, SSBP1, PPIA, SNRPB2, PSMD8, MGST1, RPL7P9, MYDGF, CTSD  #> Negative:  SIVA1, HNRNPAB, RPL39L, CDCA5, CDCA4, DEK, ASF1B, TMPO, CENPK, FAM111A  #>     BRCA1, CKLF, H2AFV, CENPX, FBXO5, ESCO2, MND1, DIAPH3, RRM1, USP1  #>     MIS18BP1, LSM4, TMEM106C, ORC6, RAD51AP1, MT-CO2, CDCA8, NCAPG, TEX30, ZWINT  #> PC_ 3  #> Positive:  SERINC2, PERP, TSPAN13, ATP1B1, SMIM22, B2M, SPINT1, ST14, F11R, SPTSSA  #>     ADGRF1, CD55, CRB3, NMB, ERBB3, SLC12A2, CXADR, C3, GPX3, CP  #>     TAX1BP1, MT-CO2, TMED10, KDM5B, CPD, SDC4, PTBP3, PLA2G16, GOLGB1, MT-CYB  #> Negative:  RPL14, RPL13AP5, RPL34, RPSAP19, RPL13AP25, SLBP, RPL9P9, RPS3AP26, DRAP1, RPL15  #>     AC024293.1, RPS5, RPSA, RPL18, RPL28, RPS3AP6, AC079250.1, SRSF2, PDCD5, RPS16  #>     CFL1, RPS11, COTL1, BASP1, CDCA7, NME1, RPS3, FEN1, MCM3, ORC6  #> PC_ 4  #> Positive:  S100A16, MRPL52, PFN1, TIMM8B, COX6B1, SLIRP, PDCD5, RPS16, LRRC59, CDA  #>     HSPE1, MGLL, GPX1, RPL18, H3F3B, TOMM40, S100A13, GPX1P1, HSPE1P3, UQCRFS1  #>     MRPS23, SNRPG, NDUFB9, MISP, CHCHD10, COX7B, CLTB, TSSC4, AC027309.2, POLR2L  #> Negative:  IFNGR1, NAMPT, NAMPTP1, CPD, C1R, ITM2B, C1S, RHOBTB3, NAP1L1, CALR  #>     ITGA2, SMC3, NCOA7, NUCB2, MCM3, CASP4, MT-ND6, ANKRD36B, LMAN1, CP  #>     RFC4, RRM1, TMEM45A, BRCA1, IFI16, CTHRC1, GLA, ADH5, CDK5RAP2, FANCL  #> PC_ 5  #> Positive:  KPNA4, PPP1R15A, RSL1D1, BTG1, RPL15, TMEM132A, NIPBL, RPSAP19, RPF2, ZYX  #>     NAP1L1, C6orf48, SNHG7, RAD21, NGDN, HDAC2, PHF20L1, ARHGEF2, MT-ND6, NOP53  #>     CALR, CEBPG, CALD1, SLU7, EIF5, SLC2A1, KIF5B, GAR1, SGK1, CDKN1A  #> Negative:  HINT1, NDUFS6, ATP6V0E1, SOD1, ATP5PO, CYB5A, NDUFB4, ATP5MC3, COX6B1, POLR2L  #>     FTH1, FTH1P8, POMP, NDUFA4, COX4I1, FTH1P10, CBR1, DDT, REX1BD, CARHSP1  #>     PSMB9, COX17, ATP5MC1, CHCHD10, NDUFB3, CLTB, PPIC, ADGRF1, COX7B, SLIRP #> 0/1: Computing nearest neighbor graph #> 0/1: Computing SNN message(paste0(\"Number of DE gene is \", sum(res$record > 0))) #> Number of DE gene is 0 ggplot2::ggplot(data = res, ggplot2::aes(x = cs)) +   ggplot2::geom_histogram(fill = \"white\", color = \"black\") +   ggplot2::theme_bw() +   ggplot2::ggtitle(\"Distribution of constrast scores\") #> `stat_bin()` using `bins = 30`. Pick better value `binwidth`."},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-cellline.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a cell line dataset","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Red Hat Enterprise Linux 8.10 (Ootpa) #>  #> Matrix products: default #> BLAS:   /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRblas.so  #> LAPACK: /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRlapack.so;  LAPACK version 3.11.0 #>  #> Random number generation: #>  RNG:     L'Ecuyer-CMRG  #>  Normal:  Inversion  #>  Sample:  Rejection  #>   #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Detroit #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats     graphics  grDevices utils     datasets  methods   base      #>  #> other attached packages: #> [1] future_1.67.0    BiocStyle_2.30.0 #>  #> loaded via a namespace (and not attached): #>   [1] RColorBrewer_1.1-3     jsonlite_2.0.0         magrittr_2.0.4         #>   [4] spatstat.utils_3.2-0   farver_2.1.2           rmarkdown_2.30         #>   [7] fs_1.6.6               ragg_1.5.0             vctrs_0.6.5            #>  [10] ROCR_1.0-11            spatstat.explore_3.5-3 htmltools_0.5.8.1      #>  [13] sass_0.4.10            sctransform_0.4.2      parallelly_1.45.1      #>  [16] KernSmooth_2.23-21     bslib_0.9.0            htmlwidgets_1.6.4      #>  [19] desc_1.4.3             ica_1.0-3              plyr_1.8.9             #>  [22] plotly_4.11.0          zoo_1.8-14             cachem_1.1.0           #>  [25] igraph_2.2.1           mime_0.13              lifecycle_1.0.4        #>  [28] pkgconfig_2.0.3        Matrix_1.6-5           R6_2.6.1               #>  [31] fastmap_1.2.0          fitdistrplus_1.2-4     shiny_1.11.1           #>  [34] digest_0.6.37          patchwork_1.3.2        Seurat_5.3.1           #>  [37] tensor_1.5.1           RSpectra_0.16-2        irlba_2.3.5.1          #>  [40] kde1d_1.1.1            textshaping_1.0.4      labeling_0.4.3         #>  [43] progressr_0.17.0       spatstat.sparse_3.1-0  coop_0.6-3             #>  [46] httr_1.4.7             polyclip_1.10-7        abind_1.4-8            #>  [49] compiler_4.3.1         withr_3.0.2            backports_1.5.0        #>  [52] S7_0.2.0               fastDummies_1.7.5      MASS_7.3-60            #>  [55] tools_4.3.1            lmtest_0.9-40          otel_0.2.0             #>  [58] httpuv_1.6.16          future.apply_1.20.0    goftest_1.2-3          #>  [61] glue_1.8.0             nlme_3.1-162           promises_1.4.0         #>  [64] grid_4.3.1             checkmate_2.3.3        Rtsne_0.17             #>  [67] cluster_2.1.4          reshape2_1.4.4         generics_0.1.4         #>  [70] gtable_0.3.6           spatstat.data_3.1-9    tidyr_1.3.1            #>  [73] data.table_1.17.8      sp_2.2-0               spatstat.geom_3.6-0    #>  [76] RcppAnnoy_0.0.22       ggrepel_0.9.6          RANN_2.6.2             #>  [79] pillar_1.11.1          stringr_1.5.2          spam_2.11-1            #>  [82] RcppHNSW_0.6.0         limma_3.58.1           later_1.4.4            #>  [85] splines_4.3.1          dplyr_1.1.4            lattice_0.21-8         #>  [88] survival_3.5-5         deldir_2.0-4           tidyselect_1.2.1       #>  [91] miniUI_0.1.2           pbapply_1.7-4          knitr_1.50             #>  [94] gridExtra_2.3          bookdown_0.45          scattermore_1.2        #>  [97] xfun_0.53              statmod_1.5.1          matrixStats_1.5.0      #> [100] stringi_1.8.7          ClusterDE_0.99.3       lazyeval_0.2.2         #> [103] yaml_2.3.10            evaluate_1.0.5         codetools_0.2-19       #> [106] tibble_3.3.0           BiocManager_1.30.26    cli_3.6.5              #> [109] uwot_0.2.3             xtable_1.8-4           reticulate_1.44.0      #> [112] systemfonts_1.3.1      jquerylib_0.1.4        Rcpp_1.1.0             #> [115] globals_0.18.0         spatstat.random_3.4-2  png_0.1-8              #> [118] rngWELL_0.10-10        spatstat.univar_3.1-4  parallel_4.3.1         #> [121] randtoolbox_2.0.5      assertthat_0.2.1       pkgdown_2.2.0          #> [124] ggplot2_4.0.0          presto_1.0.0           mvnfast_0.2.8          #> [127] dotCall64_1.2          bettermc_1.2.2.9000    gamlss.dist_6.1-1      #> [130] listenv_0.9.1          viridisLite_0.4.2      scales_1.4.0           #> [133] ggridges_0.5.7         SeuratObject_5.2.0     purrr_1.1.0            #> [136] rlang_1.1.6            rvinecopulib_0.7.3.1.0 cowplot_1.2.0"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-onedomain.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a single-domain spatial dataset","text":"selected layer 5 151673 slice LIBD Human Dorsolateral Prefrontal Cortex (DLPFC) dataset, downloaded spatialLIBD R package. Visualize real data. Since data contains one domain, domains marker genes.","code":"# # Download the spot-level data # spe <- spatialLIBD::fetch_data(type = \"spe\") # # # Select the Layer5 in the slice 151673 # sub_151673 <- spe[, spe$sample_id == \"151673\"] # index <- sub_151673$spatialLIBD == \"L5\" # index[which(is.na(index))] <- \"NAN\" # sub_151673 <- sub_151673[, index == \"TRUE\"] # print(sub_151673) # # # Delete the genes that express rate less than 20% # data <- sub_151673@assays@data$counts # zero_expre_rate <- apply(data, 1, function(x) { #   zero_true <- x == 0 #   zero_num <- length(which(zero_true == TRUE)) / dim(data)[2] #   return(zero_num) # }) # zero_expre_gene_idx <- which(zero_expre_rate < 0.8) # print(paste0(\"the number of gene with zero expression rate: \", sum(zero_expre_rate == 1), sep = \"\")) # sub_151673 <- sub_151673[zero_expre_gene_idx,] # print(paste0(\"the size of data: \", dim(sub_151673)[1], \"*\", dim(sub_151673)[2], sep = \"\")) # # # Construct the SingleCellExperiment object # real_sce <- SingleCellExperiment::SingleCellExperiment(list(counts = sub_151673@assays@data$counts)) # # Add colData information of singlecellexperiment # real_sce$spatial1 <- sub_151673@int_colData@listData$spatialCoords[, 2] # real_sce$spatial2 <- sub_151673@int_colData@listData$spatialCoords[, 1] # real_sce$cell_type <- sub_151673@colData$spatialLIBD # SingleCellExperiment::logcounts(real_sce) <- log1p(SingleCellExperiment::counts(real_sce)) # dlpfc_onedomain <- Seurat::as.Seurat(real_sce) data(dlpfc_onedomain, package = \"ClusterDE\") # Visualize the real spatial domains domains <- data.frame(Xaxis = dlpfc_onedomain$spatial1, Yaxis = dlpfc_onedomain$spatial2, Domain = dlpfc_onedomain$cell_type) #> Loading required package: SeuratObject #> Loading required package: sp #>  #> Attaching package: 'SeuratObject' #> The following objects are masked from 'package:base': #>  #>     intersect, t ggplot2::ggplot(domains, ggplot2::aes(x = Xaxis, y = Yaxis, col = Domain)) +   ggplot2::geom_point(size = 1.0) +   ggplot2::ggtitle(\"Manual annotation \\n (The layer5 in the slice 151673)\") +   ggplot2::coord_equal() +   ggplot2::theme(     plot.title = ggplot2::element_text(size = 10, hjust = 0.5),     panel.grid = ggplot2::element_blank(),     panel.background = ggplot2::element_rect(fill = \"gray90\"),     panel.border = ggplot2::element_rect(color = \"black\", fill = NA, size = 0.6),     axis.title.x = ggplot2::element_blank(),     axis.title.y = ggplot2::element_blank(),     axis.ticks.x = ggplot2::element_blank(),     axis.ticks.y = ggplot2::element_blank(),     axis.text.x = ggplot2::element_blank(),     axis.text.y = ggplot2::element_blank()   ) +   ggplot2::scale_color_manual(values = \"#5791cc\") #> Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0. #> ℹ Please use the `linewidth` argument instead. #> This warning is displayed once every 8 hours. #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated."},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-onedomain.html","id":"run-the-bayesspace-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the BayesSpace + Seurat pipeline","title":"Perform ClusterDE on a single-domain spatial dataset","text":"Firstly, employed BayesSpace spatial clustering. Please note ClusterDE designed 1 vs 1 comparison; therefore, obtain two spatial clusters illustration purpose. Visualize spatial clustering results based real data.  , used common DE method (Wilcoxon Rank Sum Test) identify domain marker genes two spatial clusters.","code":"# Construct the input of BayesSpace based on real dataset # The input of BayesSpace is sce object dlpfc_cluster <- SingleCellExperiment::SingleCellExperiment(   list(counts = Seurat::GetAssayData(dlpfc_onedomain, layer = \"counts\")) ) #> Warning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by #> 'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment' # Add colData information of SingleCellExperiment dlpfc_cluster$row <- dlpfc_onedomain@meta.data$spatial1 dlpfc_cluster$col <- dlpfc_onedomain@meta.data$spatial2  # Log-normalize the count data set.seed(123) dlpfc_cluster <- BayesSpace::spatialPreprocess(dlpfc_cluster, platform = \"ST\", n.PCs = 7, log.normalize = T) # Clustering with BayesSpace dlpfc_cluster <- BayesSpace::spatialCluster(   dlpfc_cluster,   q = 2,   platform = \"ST\",   d = 7,   init.method = \"mclust\",   model = \"t\",   gamma = 2,   nrep = 1000,   burn.in = 100,   save.chain = T ) #> Neighbors were identified for 0 out of 673 spots. #> Fitting model... #> Calculating labels using iterations 100 through 1000. # Visualize the spatial cluster clusters <- data.frame(Xaxis = dlpfc_cluster$row, Yaxis = dlpfc_cluster$col, Clusters = as.character(dlpfc_cluster$spatial.cluster)) ggplot2::ggplot(clusters, ggplot2::aes(x = Xaxis, y = Yaxis, col = Clusters)) +   ggplot2::geom_point(size = 1.0) +   ggplot2::coord_equal() +   ggplot2::ggtitle(\"Real data \\n (spatial clusters detected by BayesSpace)\") +   ggplot2::theme(     plot.title = ggplot2::element_text(size = 10, hjust = 0.5),     panel.grid = ggplot2::element_blank(),     panel.background = ggplot2::element_rect(fill = \"gray90\"),     panel.border = ggplot2::element_rect(color = \"black\", fill = NA, size = 0.6),     axis.title.x = ggplot2::element_blank(),     axis.title.y = ggplot2::element_blank(),     axis.ticks.x = ggplot2::element_blank(),     axis.ticks.y = ggplot2::element_blank(),     axis.text.x = ggplot2::element_blank(),     axis.text.y = ggplot2::element_blank()   ) +   ggplot2::scale_color_manual(values = c(\"#e87d72\", \"#54bcc2\")) # Identify domain marker genes in the real dataset based on the BayesSpace clustering result, follow Seurat tutorial dlpfc_onedomain <- Seurat::as.Seurat(dlpfc_cluster) #> Warning: Keys should be one or more alphanumeric characters followed by an #> underscore, setting key from PC to PC_ Seurat::Idents(dlpfc_onedomain) <- \"spatial.cluster\" original_markers <- Seurat::FindMarkers(   object = dlpfc_onedomain,   ident.1 = 1,   ident.2 = 2,   test.use = \"wilcox\",   logfc.threshold = 0,   min.pct = 0,   min.cells.feature = 1,   min.cells.group = 1 ) message(paste0(\"Number of DE gene is \", sum(original_markers$p_val_adj < 0.05))) #> Number of DE gene is 22"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-onedomain.html","id":"find-degs-using-clusterde","dir":"Articles","previous_headings":"","what":"Find DEGs using ClusterDE","title":"Perform ClusterDE on a single-domain spatial dataset","text":"can use findMarkers() ClusterDE spatial specified name X Y coordinates data meta columns. example, coordinates stored row col. can observe results genes frequency record 0, means detect DE genes.","code":"res <- ClusterDE::findMarkers(dlpfc_onedomain, ident.1 = 1, ident.2 = 2, spatial = c(\"row\", \"col\")) #> 100% of genes are used in correlation modelling. #> 0/1: Neighbors were identified for 0 out of 673 spots. #> 0/1: Fitting model... #> 0/1: Calculating labels using iterations 100 through 1000. #> 0/1: Normalizing layer: counts message(paste0(\"Number of DE gene is \", sum(res$record > 0))) #> Number of DE gene is 0"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-onedomain.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a single-domain spatial dataset","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Red Hat Enterprise Linux 8.10 (Ootpa) #>  #> Matrix products: default #> BLAS:   /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRblas.so  #> LAPACK: /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRlapack.so;  LAPACK version 3.11.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Detroit #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats     graphics  grDevices utils     datasets  methods   base      #>  #> other attached packages: #> [1] SeuratObject_5.2.0 sp_2.2-0           BiocStyle_2.30.0   #>  #> loaded via a namespace (and not attached): #>   [1] fs_1.6.6                    matrixStats_1.5.0           #>   [3] spatstat.sparse_3.1-0       bitops_1.0-9                #>   [5] httr_1.4.7                  RColorBrewer_1.1-3          #>   [7] backports_1.5.0             tools_4.3.1                 #>   [9] sctransform_0.4.2           R6_2.6.1                    #>  [11] DirichletReg_0.7-2          lazyeval_0.2.2              #>  [13] uwot_0.2.3                  rhdf5filters_1.14.1         #>  [15] withr_3.0.2                 ClusterDE_0.99.3            #>  [17] gridExtra_2.3               progressr_0.17.0            #>  [19] cli_3.6.5                   Biobase_2.62.0              #>  [21] textshaping_1.0.4           spatstat.explore_3.5-3      #>  [23] fastDummies_1.7.5           sandwich_3.1-1              #>  [25] labeling_0.4.3              sass_0.4.10                 #>  [27] Seurat_5.3.1                S7_0.2.0                    #>  [29] spatstat.data_3.1-9         ggridges_0.5.7              #>  [31] pbapply_1.7-4               pkgdown_2.2.0               #>  [33] systemfonts_1.3.1           scater_1.30.1               #>  [35] parallelly_1.45.1           limma_3.58.1                #>  [37] RSQLite_2.4.5               generics_0.1.4              #>  [39] ica_1.0-3                   spatstat.random_3.4-2       #>  [41] dplyr_1.1.4                 Matrix_1.6-5                #>  [43] ggbeeswarm_0.7.3            S4Vectors_0.40.2            #>  [45] abind_1.4-8                 lifecycle_1.0.4             #>  [47] yaml_2.3.10                 edgeR_4.0.16                #>  [49] SummarizedExperiment_1.32.0 rhdf5_2.46.1                #>  [51] SparseArray_1.2.4           BiocFileCache_2.10.2        #>  [53] Rtsne_0.17                  grid_4.3.1                  #>  [55] blob_1.2.4                  promises_1.4.0              #>  [57] dqrng_0.4.1                 crayon_1.5.3                #>  [59] miniUI_0.1.2                lattice_0.21-8              #>  [61] beachmat_2.18.1             cowplot_1.2.0               #>  [63] kde1d_1.1.1                 pillar_1.11.1               #>  [65] knitr_1.50                  metapod_1.10.1              #>  [67] GenomicRanges_1.54.1        randtoolbox_2.0.5           #>  [69] xgboost_3.1.2.1             future.apply_1.20.0         #>  [71] codetools_0.2-19            glue_1.8.0                  #>  [73] spatstat.univar_3.1-4       data.table_1.17.8           #>  [75] vctrs_0.6.5                 png_0.1-8                   #>  [77] spam_2.11-1                 gtable_0.3.6                #>  [79] assertthat_0.2.1            cachem_1.1.0                #>  [81] xfun_0.53                   S4Arrays_1.2.1              #>  [83] mime_0.13                   coop_0.6-3                  #>  [85] rngWELL_0.10-10             coda_0.19-4.1               #>  [87] survival_3.5-5              SingleCellExperiment_1.24.0 #>  [89] maxLik_1.5-2.1              statmod_1.5.1               #>  [91] bluster_1.12.0              BayesSpace_1.12.0           #>  [93] fitdistrplus_1.2-4          ROCR_1.0-11                 #>  [95] bettermc_1.2.2.9000         nlme_3.1-162                #>  [97] bit64_4.6.0-1               filelock_1.0.3              #>  [99] RcppAnnoy_0.0.22            GenomeInfoDb_1.38.8         #> [101] bslib_0.9.0                 irlba_2.3.5.1               #> [103] vipor_0.4.7                 KernSmooth_2.23-21          #> [105] otel_0.2.0                  BiocGenerics_0.48.1         #> [107] DBI_1.2.3                   tidyselect_1.2.1            #> [109] bit_4.6.0                   compiler_4.3.1              #> [111] curl_7.0.0                  BiocNeighbors_1.20.2        #> [113] desc_1.4.3                  DelayedArray_0.28.0         #> [115] plotly_4.11.0               bookdown_0.45               #> [117] checkmate_2.3.3             scales_1.4.0                #> [119] lmtest_0.9-40               mvnfast_0.2.8               #> [121] rvinecopulib_0.7.3.1.0      stringr_1.5.2               #> [123] digest_0.6.37               goftest_1.2-3               #> [125] presto_1.0.0                spatstat.utils_3.2-0        #> [127] rmarkdown_2.30              XVector_0.42.0              #> [129] htmltools_0.5.8.1           pkgconfig_2.0.3             #> [131] sparseMatrixStats_1.14.0    MatrixGenerics_1.14.0       #> [133] dbplyr_2.5.1                fastmap_1.2.0               #> [135] rlang_1.1.6                 htmlwidgets_1.6.4           #> [137] shiny_1.11.1                DelayedMatrixStats_1.24.0   #> [139] farver_2.1.2                jquerylib_0.1.4             #> [141] zoo_1.8-14                  jsonlite_2.0.0              #> [143] BiocParallel_1.36.0         mclust_6.1.1                #> [145] BiocSingular_1.18.0         RCurl_1.98-1.17             #> [147] magrittr_2.0.4              Formula_1.2-5               #> [149] scuttle_1.12.0              GenomeInfoDbData_1.2.11     #> [151] dotCall64_1.2               patchwork_1.3.2             #> [153] Rhdf5lib_1.24.2             Rcpp_1.1.0                  #> [155] viridis_0.6.5               reticulate_1.44.0           #> [157] stringi_1.8.7               zlibbioc_1.48.2             #> [159] MASS_7.3-60                 gamlss.dist_6.1-1           #> [161] plyr_1.8.9                  parallel_4.3.1              #> [163] listenv_0.9.1               ggrepel_0.9.6               #> [165] deldir_2.0-4                splines_4.3.1               #> [167] tensor_1.5.1                locfit_1.5-9.12             #> [169] igraph_2.2.1                spatstat.geom_3.6-0         #> [171] RcppHNSW_0.6.0              reshape2_1.4.4              #> [173] stats4_4.3.1                ScaledMatrix_1.10.0         #> [175] evaluate_1.0.5              scran_1.30.2                #> [177] BiocManager_1.30.26         httpuv_1.6.16               #> [179] miscTools_0.6-28            RANN_2.6.2                  #> [181] tidyr_1.3.1                 purrr_1.1.0                 #> [183] polyclip_1.10-7             future_1.67.0               #> [185] scattermore_1.2             ggplot2_4.0.0               #> [187] rsvd_1.0.5                  xtable_1.8-4                #> [189] RSpectra_0.16-2             later_1.4.4                 #> [191] viridisLite_0.4.2           ragg_1.5.0                  #> [193] tibble_3.3.0                memoise_2.0.1               #> [195] beeswarm_0.4.0              IRanges_2.36.0              #> [197] cluster_2.1.4               globals_0.18.0"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-twodomains.html","id":"download-data","dir":"Articles","previous_headings":"","what":"Download data","title":"Perform ClusterDE on a two-domain spatial dataset","text":"selected adjacent layer 6 WM 151673 slice LIBD Human Dorsolateral Prefrontal Cortex (DLPFC) dataset, downloaded spatialLIBD R package. removed genes expressed fewer 20% spots save computational time . Visualize real data two domains (L6 WM).","code":"# # Download the spot-level data # spe <- spatialLIBD::fetch_data(type = \"spe\") # # # Select the Layer6 and WM domains in the slice \"151673\" # sub_151673 <- spe[, spe$sample_id == \"151673\"] # index <- sub_151673$spatialLIBD == \"L6\" | sub_151673$spatialLIBD == \"WM\" # index[which(is.na(index))] <- \"NAN\" # sub_151673 <- sub_151673[, index == \"TRUE\"] # print(sub_151673) # # # Delete the genes that express rate less than 20% # data <- sub_151673@assays@data$counts # zero_expre_rate <- apply(data, 1, function(x) { #   zero_true <- x == 0 #   zero_num <- length(which(zero_true == TRUE)) / dim(data)[2] #   return(zero_num) # }) # zero_expre_gene_idx <- which(zero_expre_rate < 0.8) # sub_151673 <- sub_151673[zero_expre_gene_idx,] # cat(paste0(\"The size of data: \", dim(sub_151673)[1], \"*\", dim(sub_151673)[2], sep = \"\")) # # # Construct the SingleCellExperiment object # dlpfc_twodomain <- SingleCellExperiment::SingleCellExperiment(list(counts = sub_151673@assays@data$counts)) # # Add colData information of singlecellexperiment # dlpfc_twodomain$spatial1 <- sub_151673@int_colData@listData$spatialCoords[, 2] # dlpfc_twodomain$spatial2 <- sub_151673@int_colData@listData$spatialCoords[, 1] # dlpfc_twodomain$cell_type <- sub_151673@colData$spatialLIBD # SingleCellExperiment::logcounts(dlpfc_twodomain) <- log1p(SingleCellExperiment::counts(dlpfc_twodomain)) # dlpfc_twodomain <- Seurat::as.Seurat(dlpfc_twodomain) data(dlpfc_twodomain, package = \"ClusterDE\") # Visualize the real spatial domains domains <- data.frame(Xaxis = dlpfc_twodomain$spatial1, Yaxis = dlpfc_twodomain$spatial2, Domains = dlpfc_twodomain$cell_type) #> Loading required package: SeuratObject #> Loading required package: sp #>  #> Attaching package: 'SeuratObject' #> The following objects are masked from 'package:base': #>  #>     intersect, t ggplot2::ggplot(domains, ggplot2::aes(x = Xaxis, y = Yaxis, col = Domains)) +   ggplot2::geom_point(size = 1.0) +   ggplot2::coord_equal() +   ggplot2::ggtitle(\"Manual annotation \\n (The layer6 and WM in the slice 151673)\") +   ggplot2::theme(     plot.title = ggplot2::element_text(size = 10, hjust = 0.5),     panel.grid = ggplot2::element_blank(),     panel.background = ggplot2::element_rect(fill = \"gray90\"),     panel.border = ggplot2::element_rect(color = \"black\", fill = NA, linewidth = 0.6),     axis.title.x = ggplot2::element_blank(),     axis.title.y = ggplot2::element_blank(),     axis.ticks.x = ggplot2::element_blank(),     axis.ticks.y = ggplot2::element_blank(),     axis.text.x = ggplot2::element_blank(),     axis.text.y = ggplot2::element_blank()   ) +   ggplot2::scale_color_manual(values = c(\"#5791cc\", \"#403f92\"))"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-twodomains.html","id":"run-the-bayesspace-seurat-pipeline","dir":"Articles","previous_headings":"","what":"Run the BayesSpace + Seurat pipeline","title":"Perform ClusterDE on a two-domain spatial dataset","text":"Firstly, employed BayesSpace spatial clustering. Please note ClusterDE designed 1 vs 1 comparison; therefore, obtain two spatial clusters illustration purpose. Visualize spatial clustering results based real data.  , used common DE method (Wilcoxon Rank Sum Test) identify domain marker genes two spatial clusters.","code":"# Construct the input of BayesSpace based on real dataset # The input of BayesSpace is sce object dlpfc_cluster <- SingleCellExperiment::SingleCellExperiment(   list(counts = Seurat::GetAssayData(dlpfc_twodomain, layer = \"counts\")) ) #> Warning: replacing previous import 'S4Arrays::makeNindexFromArrayViewport' by #> 'DelayedArray::makeNindexFromArrayViewport' when loading 'SummarizedExperiment' # Add colData information of singlecellexperiment dlpfc_cluster$row <- dlpfc_twodomain$spatial1 dlpfc_cluster$col <- dlpfc_twodomain$spatial2  # Log-normalize the count data set.seed(123) dlpfc_cluster <- BayesSpace::spatialPreprocess(dlpfc_cluster, platform = \"ST\", n.PCs = 7, log.normalize = T) # Clustering with BayesSpace dlpfc_cluster <- BayesSpace::spatialCluster(   dlpfc_cluster,   q = 2,   platform = \"ST\",   d = 7,   init.method = \"mclust\",   model = \"t\",   gamma = 2,   nrep = 1000,   burn.in = 100,   save.chain = T ) #> Neighbors were identified for 0 out of 1205 spots. #> Fitting model... #> You created a large dataset with compression and chunking. #> The chunk size is equal to the dataset dimensions. #> If you want to read subsets of the dataset, you should testsmaller chunk sizes to improve read times. #> You created a large dataset with compression and chunking. #> The chunk size is equal to the dataset dimensions. #> If you want to read subsets of the dataset, you should testsmaller chunk sizes to improve read times. #> Calculating labels using iterations 100 through 1000. # Visualize the spatial cluster clusters <- data.frame(Xaxis = dlpfc_cluster$row, Yaxis = dlpfc_cluster$col, Clusters = as.character(dlpfc_cluster$spatial.cluster)) ggplot2::ggplot(clusters, ggplot2::aes(x = Xaxis, y = Yaxis, col = Clusters)) +   ggplot2::geom_point(size = 1.0) +   ggplot2::coord_equal() +   ggplot2::ggtitle(\"Real data \\n (spatial clusters detected by BayesSpace)\") +   ggplot2::theme(     plot.title = ggplot2::element_text(size = 10, hjust = 0.5),     panel.grid = ggplot2::element_blank(),     panel.background = ggplot2::element_rect(fill = \"gray90\"),     panel.border = ggplot2::element_rect(color = \"black\", fill = NA, size = 0.6),     axis.title.x = ggplot2::element_blank(),     axis.title.y = ggplot2::element_blank(),     axis.ticks.x = ggplot2::element_blank(),     axis.ticks.y = ggplot2::element_blank(),     axis.text.x = ggplot2::element_blank(),     axis.text.y = ggplot2::element_blank()   ) +   ggplot2::scale_color_manual(values = c(\"#e87d72\", \"#54bcc2\")) #> Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0. #> ℹ Please use the `linewidth` argument instead. #> This warning is displayed once every 8 hours. #> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was #> generated. # Identify domain marker genes in the real dataset based on the BayesSpace clustering result, follow Seurat tutorial dlpfc_twodomain <- Seurat::as.Seurat(dlpfc_cluster) #> Warning: Keys should be one or more alphanumeric characters followed by an #> underscore, setting key from PC to PC_ Seurat::Idents(dlpfc_twodomain) <- \"spatial.cluster\" original_markers <- Seurat::FindMarkers(   object = dlpfc_twodomain,   ident.1 = 1,   ident.2 = 2,   test.use = \"wilcox\",   logfc.threshold = 0,   min.pct = 0,   min.cells.feature = 1,   min.cells.group = 1 ) head(original_markers) #>                         p_val avg_log2FC pct.1 pct.2     p_val_adj #> ENSG00000197971 1.620014e-188   3.071046 1.000 0.995 4.537659e-185 #> ENSG00000123560 8.266927e-180   3.262644 1.000 0.967 2.315566e-176 #> ENSG00000131095 1.904118e-172   2.949736 0.998 0.850 5.333433e-169 #> ENSG00000109846 1.878857e-167   3.166675 0.995 0.790 5.262680e-164 #> ENSG00000173786 2.472031e-165   3.081083 0.995 0.725 6.924158e-162 #> ENSG00000168314 5.661648e-150   3.056843 0.971 0.504 1.585827e-146"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-twodomains.html","id":"find-degs-using-clusterde","dir":"Articles","previous_headings":"","what":"Find DEGs using ClusterDE","title":"Perform ClusterDE on a two-domain spatial dataset","text":"can use findMarkers() ClusterDE spatial specified name X Y coordinates data meta columns. example, coordinates stored row col.","code":"res <- ClusterDE::findMarkers(dlpfc_twodomain, ident.1 = 1, ident.2 = 2, spatial = c(\"row\", \"col\")) #> 100% of genes are used in correlation modelling. #> 0/1: Neighbors were identified for 0 out of 1205 spots. #> 0/1: Fitting model... #> 0/1: You created a large dataset with compression and chunking. #> The chunk size is equal to the dataset dimensions. #> If you want to read subsets of the dataset, you should testsmaller chunk sizes to improve read times. #> 0/1: You created a large dataset with compression and chunking. #> The chunk size is equal to the dataset dimensions. #> If you want to read subsets of the dataset, you should testsmaller chunk sizes to improve read times. #> 0/1: Calculating labels using iterations 100 through 1000. #> 0/1: Normalizing layer: counts"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-twodomains.html","id":"visualize-top-marker-genes","dir":"Articles","previous_headings":"","what":"Visualize top marker genes","title":"Perform ClusterDE on a two-domain spatial dataset","text":"visualize top DE genes ClusterDE. expected, top genes detected ClusterDE exhibit clear spatial expression patterns.","code":"top_genes_clusterde <- res$gene[1:6] expr <- Seurat::GetAssayData(dlpfc_twodomain, layer = \"data\")[top_genes_clusterde, , drop = F] x_coord <- dlpfc_twodomain@meta.data$row y_coord <- dlpfc_twodomain@meta.data$col  plots <- lapply(top_genes_clusterde, function(gene) {   df <- data.frame(     X = x_coord,     Y = y_coord,     Expr = as.numeric(expr[gene,])   )   ggplot2::ggplot(df, ggplot2::aes(x = X, y = Y, color = Expr)) +     ggplot2::geom_point(size = 1) +     ggplot2::scale_colour_gradientn(colors = viridis::viridis_pal(option = \"magma\")(10)) +     ggplot2::coord_fixed() +     ggplot2::ggtitle(gene) +     ggplot2::theme_void() +     ggplot2::theme(legend.position = \"bottom\") })  patchwork::wrap_plots(plots, nrow = 2)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/articles/ClusterDE-twodomains.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"Perform ClusterDE on a two-domain spatial dataset","text":"","code":"sessionInfo() #> R version 4.3.1 (2023-06-16) #> Platform: x86_64-pc-linux-gnu (64-bit) #> Running under: Red Hat Enterprise Linux 8.10 (Ootpa) #>  #> Matrix products: default #> BLAS:   /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRblas.so  #> LAPACK: /sw/pkgs/arc/stacks/gcc/10.3.0/R/4.3.1/lib64/R/lib/libRlapack.so;  LAPACK version 3.11.0 #>  #> locale: #>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               #>  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     #>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    #>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  #>  [9] LC_ADDRESS=C               LC_TELEPHONE=C             #> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        #>  #> time zone: America/Detroit #> tzcode source: system (glibc) #>  #> attached base packages: #> [1] stats     graphics  grDevices utils     datasets  methods   base      #>  #> other attached packages: #> [1] SeuratObject_5.2.0 sp_2.2-0           BiocStyle_2.30.0   #>  #> loaded via a namespace (and not attached): #>   [1] fs_1.6.6                    matrixStats_1.5.0           #>   [3] spatstat.sparse_3.1-0       bitops_1.0-9                #>   [5] httr_1.4.7                  RColorBrewer_1.1-3          #>   [7] backports_1.5.0             tools_4.3.1                 #>   [9] sctransform_0.4.2           R6_2.6.1                    #>  [11] DirichletReg_0.7-2          lazyeval_0.2.2              #>  [13] uwot_0.2.3                  rhdf5filters_1.14.1         #>  [15] withr_3.0.2                 ClusterDE_0.99.3            #>  [17] gridExtra_2.3               progressr_0.17.0            #>  [19] cli_3.6.5                   Biobase_2.62.0              #>  [21] textshaping_1.0.4           spatstat.explore_3.5-3      #>  [23] fastDummies_1.7.5           sandwich_3.1-1              #>  [25] labeling_0.4.3              sass_0.4.10                 #>  [27] Seurat_5.3.1                S7_0.2.0                    #>  [29] spatstat.data_3.1-9         ggridges_0.5.7              #>  [31] pbapply_1.7-4               pkgdown_2.2.0               #>  [33] systemfonts_1.3.1           scater_1.30.1               #>  [35] parallelly_1.45.1           limma_3.58.1                #>  [37] RSQLite_2.4.5               generics_0.1.4              #>  [39] ica_1.0-3                   spatstat.random_3.4-2       #>  [41] dplyr_1.1.4                 Matrix_1.6-5                #>  [43] ggbeeswarm_0.7.3            S4Vectors_0.40.2            #>  [45] abind_1.4-8                 lifecycle_1.0.4             #>  [47] yaml_2.3.10                 edgeR_4.0.16                #>  [49] SummarizedExperiment_1.32.0 rhdf5_2.46.1                #>  [51] SparseArray_1.2.4           BiocFileCache_2.10.2        #>  [53] Rtsne_0.17                  grid_4.3.1                  #>  [55] blob_1.2.4                  promises_1.4.0              #>  [57] dqrng_0.4.1                 crayon_1.5.3                #>  [59] miniUI_0.1.2                lattice_0.21-8              #>  [61] beachmat_2.18.1             cowplot_1.2.0               #>  [63] kde1d_1.1.1                 pillar_1.11.1               #>  [65] knitr_1.50                  metapod_1.10.1              #>  [67] GenomicRanges_1.54.1        randtoolbox_2.0.5           #>  [69] xgboost_3.1.2.1             future.apply_1.20.0         #>  [71] codetools_0.2-19            glue_1.8.0                  #>  [73] spatstat.univar_3.1-4       data.table_1.17.8           #>  [75] vctrs_0.6.5                 png_0.1-8                   #>  [77] spam_2.11-1                 gtable_0.3.6                #>  [79] assertthat_0.2.1            cachem_1.1.0                #>  [81] xfun_0.53                   S4Arrays_1.2.1              #>  [83] mime_0.13                   coop_0.6-3                  #>  [85] rngWELL_0.10-10             coda_0.19-4.1               #>  [87] survival_3.5-5              SingleCellExperiment_1.24.0 #>  [89] maxLik_1.5-2.1              statmod_1.5.1               #>  [91] bluster_1.12.0              BayesSpace_1.12.0           #>  [93] fitdistrplus_1.2-4          ROCR_1.0-11                 #>  [95] bettermc_1.2.2.9000         nlme_3.1-162                #>  [97] bit64_4.6.0-1               filelock_1.0.3              #>  [99] RcppAnnoy_0.0.22            GenomeInfoDb_1.38.8         #> [101] bslib_0.9.0                 irlba_2.3.5.1               #> [103] vipor_0.4.7                 KernSmooth_2.23-21          #> [105] otel_0.2.0                  BiocGenerics_0.48.1         #> [107] DBI_1.2.3                   tidyselect_1.2.1            #> [109] bit_4.6.0                   compiler_4.3.1              #> [111] curl_7.0.0                  BiocNeighbors_1.20.2        #> [113] desc_1.4.3                  DelayedArray_0.28.0         #> [115] plotly_4.11.0               bookdown_0.45               #> [117] checkmate_2.3.3             scales_1.4.0                #> [119] lmtest_0.9-40               mvnfast_0.2.8               #> [121] rvinecopulib_0.7.3.1.0      stringr_1.5.2               #> [123] digest_0.6.37               goftest_1.2-3               #> [125] presto_1.0.0                spatstat.utils_3.2-0        #> [127] rmarkdown_2.30              XVector_0.42.0              #> [129] htmltools_0.5.8.1           pkgconfig_2.0.3             #> [131] sparseMatrixStats_1.14.0    MatrixGenerics_1.14.0       #> [133] dbplyr_2.5.1                fastmap_1.2.0               #> [135] rlang_1.1.6                 htmlwidgets_1.6.4           #> [137] shiny_1.11.1                DelayedMatrixStats_1.24.0   #> [139] farver_2.1.2                jquerylib_0.1.4             #> [141] zoo_1.8-14                  jsonlite_2.0.0              #> [143] BiocParallel_1.36.0         mclust_6.1.1                #> [145] BiocSingular_1.18.0         RCurl_1.98-1.17             #> [147] magrittr_2.0.4              Formula_1.2-5               #> [149] scuttle_1.12.0              GenomeInfoDbData_1.2.11     #> [151] dotCall64_1.2               patchwork_1.3.2             #> [153] Rhdf5lib_1.24.2             Rcpp_1.1.0                  #> [155] viridis_0.6.5               reticulate_1.44.0           #> [157] stringi_1.8.7               zlibbioc_1.48.2             #> [159] MASS_7.3-60                 gamlss.dist_6.1-1           #> [161] plyr_1.8.9                  parallel_4.3.1              #> [163] listenv_0.9.1               ggrepel_0.9.6               #> [165] deldir_2.0-4                splines_4.3.1               #> [167] tensor_1.5.1                locfit_1.5-9.12             #> [169] igraph_2.2.1                spatstat.geom_3.6-0         #> [171] RcppHNSW_0.6.0              reshape2_1.4.4              #> [173] stats4_4.3.1                ScaledMatrix_1.10.0         #> [175] evaluate_1.0.5              scran_1.30.2                #> [177] BiocManager_1.30.26         httpuv_1.6.16               #> [179] miscTools_0.6-28            RANN_2.6.2                  #> [181] tidyr_1.3.1                 purrr_1.1.0                 #> [183] polyclip_1.10-7             future_1.67.0               #> [185] scattermore_1.2             ggplot2_4.0.0               #> [187] rsvd_1.0.5                  xtable_1.8-4                #> [189] RSpectra_0.16-2             later_1.4.4                 #> [191] viridisLite_0.4.2           ragg_1.5.0                  #> [193] tibble_3.3.0                memoise_2.0.1               #> [195] beeswarm_0.4.0              IRanges_2.36.0              #> [197] cluster_2.1.4               globals_0.18.0"},{"path":"https://songdongyuan1994.github.io/ClusterDE/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Dongyuan Song. Author, maintainer. Kexin Li. Author. Siqi Chen. Author.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Song D, Li K, Chen S (2025). ClusterDE: Post-clustering Differential Expression (DE) Method Solving Double Dipping. https://github.com/SONGDONGYUAN1994/ClusterDE, https://songdongyuan1994.github.io/ClusterDE/.","code":"@Manual{,   title = {ClusterDE: A Post-clustering Differential Expression (DE) Method For Solving Double Dipping},   author = {Dongyuan Song and Kexin Li and Siqi Chen},   year = {2025},   note = {https://github.com/SONGDONGYUAN1994/ClusterDE, https://songdongyuan1994.github.io/ClusterDE/}, }"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"clusterde","dir":"","previous_headings":"","what":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"R package ClusterDE post-clustering DE method controlling false discovery rate (FDR) identified cell-type DE genes regardless clustering quality. core idea ClusterDE generate real-data-based synthetic null data one cell type, contrast real data, evaluating whole procedure clustering followed DE test.  Detailed tutorials illustrate various functionalities ClusterDE available website. following illustration figure summarizes usage ClusterDE:  Instead new pipeline, ClusterDE actually works add-popular pipelines Seurat. find details ClusterDE, can check manuscript bioRxiv.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"changelog","dir":"","previous_headings":"","what":"Changelog","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"Add functions spatial clustering motivation application ClusterDE: Seurat function findMarkers, authors pointed : “p-values interpreted cautiously, genes used clustering genes tested differential expression.” “double-dipping” issue. clustering results inaccurate since clustering used expression data already, discovered DE genes may represent discrete cell type separation, variation data (e.g., cell cycle, total UMI, variation clear. still biological variation define discrete status). ClusterDE aims correcting double-dipping issue comparing two dubious clusters, sure two discrete cell types just artifact clustering algorithm based conventional DE analysis. ClusterDE controls false discoveries DE prioritizes true cell type markers. Note: current version focusing one vs one comparison.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"install development version GitHub, please run: Please note ClusterDE actually wrapper scDesign3. Therefore, can also directly use scDesign3 \" design\" synthetic null data. better understand scDesign3, can check manuscript Nature Biotechnology: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023).","code":"if (!require(\"devtools\", quietly = TRUE))     install.packages(\"devtools\") devtools::install_github(\"SONGDONGYUAN1994/ClusterDE\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick Start","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"basic way identify differentially expressed genes (DEGs) two clusters use ClusterDE::findMarkers() Seurat object already contains count matrix clustering results. generates list genes ranked contrast score (cs), higher scores indicate stronger differential expression. gene: gene symbol cs: contrast score record: indicator reproducibility across null replicates","code":"# obj is a preprocessed Seurat object with clustering completed markers <- ClusterDE::findMarkers(obj, ident.1 = 0, ident.2 = 1) head(markers) # # A tibble: 6 × 3 #   gene        cs record #   <chr>    <dbl>  <dbl> # 1 CDKN1C    39.9      1 # 2 CD79B     38.6      1 # 3 FCGR3A    33.8      1 # 4 CKB       32.3      1 # 5 SIGLEC10  24.4      1 # 6 MTSS1     23.8      1"},{"path":[]},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"pca-approximation","dir":"","previous_headings":"","what":"PCA approximation","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"faster stable DEG detection using multiple null-data replicates, recommend using PCA-based approximation generating synthetic null data. Enable setting flavour argument findMarkers() \"pca\" (default \"classic\"). Increase number threads (nCores) speed parallel calculation.","code":"markers <- ClusterDE::findMarkers(obj, ident.1 = 0, ident.2 = 1, flavour = \"pca\", nCores = 8, nRep = 40)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"customize-null-data-generation","dir":"","previous_headings":"","what":"Customize null data generation","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"Beyond default findMarkers() parameters, ClusterDE also allows users customize analysis pipeline, particularly generation inspection synthetic null data. example shows manually generate null data gene--cell matrix containing two clusters interest. typical UMI count data, recommend using Negative Binomial model (nb). synthetic null data generation relatively time-consuming; may use fast version (fastVersion = TRUE). parameters constructNull() : mat: input gene cell matrix. can sparse matrix. family: string distribution want use fitting model. Must one ‘poisson’, ‘nb’, ‘zip’, ‘zinb’ ‘gaussian’. formula: string mu parameter formula. defines relationship gene expression synthetic null data extra covariates. Default NULL (cell type case). example, input data spatial data X, Y coordinates, formula can ‘s(X, Y, bs = ’gp’, k = 4)’. extraInfo: data frame extra covariates used . example, 2D spatial coordinates. Default NULL. nCores: integer. number cores use. Increasing cores greatly speed computation. parallelization: string indicating specific parallelization function use. Must one ‘mcmapply’, ‘bpmapply’, ‘pbmcmapply’, corresponds parallelization function package ‘parallel’, ‘BiocParallel’, ‘pbmcapply’ respectively. default value ‘pbmcmapply’. fastVersion: logic value. TRUE, fast approximation used. corrCut: numeric value. cutoff non-zero proportions genes used modelling correlation. reason lowly expressed genes hard calculate correlation. BPPARAM: MulticoreParam object NULL. parameter parallelization = ‘mcmapply’ ‘pbmcmapply’, parameter must NULL. parameter parallelization = ‘bpmapply’, parameter must one MulticoreParam object offered package ‘BiocParallel’. default value NULL. approximation: TBA usePca: TBA nPcs: TBA output constructNull() new gene cell matrix format input. following figure briefly describes ClusterDE generates synthetic null data:  obtaining synthetic null data, use calcNullPval() perform standard preprocessing clustering pipeline get DE p-values (nullPvalues). Finally, compare p-values null p-values target data (real data) callDE(). illustration, use Uniform random numbers p-values. parameters callDE : targetScores: named numeric vector DE scores target data, e.g., p-values two clusters real data. nullScores: named numeric vector DE scores synthetic null data, e.g., p-values two clusters null data. nlogTrans: logical value. input scores p-values, take -log10 transformation since Clipper require larger scores represent significant DE. Default TRUE. FDR: numeric value target False Discovery Rate (FDR). Default 0.05. correct: logical value. TRUE, perform correction make distribution contrast scores approximately symmetric. Default FALSE. output callDE() list DE genes, output findMarkers().","code":"data(exampleCounts) nullData <- ClusterDE::constructNull(   mat = exampleCounts,   family = \"nb\",   formula = NULL,   extraInfo = NULL,   nCores = 1,   parallelization = \"mcmapply\",   fastVersion = FALSE,   corrCut = 0.2,   BPPARAM = NULL ) set.seed(123) targetPvalues <- Seurat::FindMarkers(obj, ident.1 = 0, ident.2 = 1) nullPvalues <- ClusterDE::calcNullPval(nullData) res <- ClusterDE::callDE(   targetScores = targetPvalues,   nullScores = nullPvalues,   nlogTrans = TRUE,   FDR = 0.05,   correct = FALSE )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"tutorials","dir":"","previous_headings":"","what":"Tutorials","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"detailed tutorials, please check website. tutorials demonstrate applications ClusterDE two cases: cell line dataset (cell type exists) PBMC dataset. Perform ClusterDE cell line dataset Perform ClusterDE PBMC dataset Perform ClusterDE single-domain spatial transcriptomics dataset Perform ClusterDE two-domains spatial transcriptomics dataset","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"contact","dir":"","previous_headings":"","what":"Contact","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"questions suggestions ClusterDE welcomed! Please report issues, contact Dongyuan Song (dongyuansong@ucla.edu).","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"related-papers","dir":"","previous_headings":"","what":"Related Papers","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"scDesign3: Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic silico data multimodal single-cell spatial omics. Nat Biotechnol (2023). Clipper: Ge, X., Chen, Y.E., Song, D. et al. Clipper: p-value-free FDR control high-throughput data two conditions. Genome Biology 22, 288 (2021).","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/index.html","id":"other-methods-for-double-dipping-problem","dir":"","previous_headings":"","what":"Other methods for double dipping problem","title":"A Post-clustering Differential Expression (DE) Method For Solving Double Dipping","text":"TN test: Zhang, J.M., Kamath, G.M., David, N.T. Valid post-clustering differential analysis single-cell rna-seq. Cell Systems, 2019 count split: Neufeld, ., Gao, L.L., Popp, J., Battle, ., Witten, D. Inference latent variable estimation single-cell RNA sequencing data. Biostatistics, 2022","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/calcNullPval.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate pval for each gene in synthetic null data — calcNullPval","title":"Calculate pval for each gene in synthetic null data — calcNullPval","text":"Runs Seurat-based null differential expression analysis provided synthetic null datasets.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/calcNullPval.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate pval for each gene in synthetic null data — calcNullPval","text":"","code":"calcNullPval(   synthetic_null,   spatial_coords = NULL,   normalize = T,   hvg = NULL,   seed = 123,   nCores = 1 )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/calcNullPval.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate pval for each gene in synthetic null data — calcNullPval","text":"synthetic_null matrix (genes x cells), list matrices representing synthetic null data. list, coerced list. spatial_coords data frame, contain two columns representing X Y coordinates using spatial data. Default NULL. normalize Logical; TRUE (default), apply Seurat's NormalizeData dataset. FALSE, sets assay data directly. Set false null data generated using PCA approximation. recommended provide hvg normalize false. hvg list feaures; applied normalization set false. seed Numeric; random seed clustering reproducibility (default: 123). nCores integer. number cores use parallel processing.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/calcNullPval.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate pval for each gene in synthetic null data — calcNullPval","text":"named list preprocess data gene p-values","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":null,"dir":"Reference","previous_headings":"","what":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"callDE takes two vectors representing gene's significance. usually p-values target data synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"","code":"callDE(   targetScores,   nullScores,   nlogTrans = TRUE,   FDR = 0.05,   contrastScore = \"diff\",   correct = FALSE,   threshold = \"BC\",   ordering = TRUE,   nCores = 1 )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"targetScores named numeric vector DE scores target data, e.g., p-values two clusters real data. nullScores named numeric vector DE scores synthetic null data, e.g., p-values two clusters null data. nlogTrans logical value. input scores p-values, take -log10 transformation since Clipper require larger scores represent significant DE. Default TRUE. FDR numeric value target False Discovery Rate (FDR). Must 'diff' 'max'. contrastScore string value way construct contrast scores. choice can correct logical value. TRUE, perform correction make distribution contrast scores approximately symmetric. Default FALSE. threshold string value threshold method. Must 'BC' 'DS'. ordering logic value. TRUE, order genes returned table significance. Default TRUE.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"list target FDR, DE genes, detailed summary table.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"function constructs contrast scores taking difference target DE scores null DE scores.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/callDE.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Call differentially expressed (DE) genes by Clipper algorithm — callDE","text":"","code":"targetScores <- runif(10000) nullScores <- runif(10000) names(targetScores) <- names(nullScores) <- paste0(\"Gene\", 1:10000) res <- callDE(targetScores, nullScores, correct = FALSE)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":null,"dir":"Reference","previous_headings":"","what":"Construct the synthetic null data — constructNull","title":"Construct the synthetic null data — constructNull","text":"constructNull takes target data input returns corresponding synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Construct the synthetic null data — constructNull","text":"","code":"constructNull(   obj,   family = \"nb\",   spatial = NULL,   nCores = 1,   nRep = 1,   parallelization = \"mcmapply\",   fastVersion = TRUE,   ifSparse = FALSE,   corrCut = 0.1,   BPPARAM = NULL,   approximation = FALSE,   usePca = F,   nPcs = 200 )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Construct the synthetic null data — constructNull","text":"obj Seurat object. reference data. family string vector strings distribution data. Must one 'nb', 'binomial', 'poisson', 'zip', 'zinb' 'gaussian', represent 'poisson distribution', 'negative binomial distribution', 'zero-inflated poisson distribution', 'zero-inflated negative binomail distribution', 'gaussian distribution' respectively. UMI-counts data, usually use 'nb'. Default 'nb'. spatial vector 2 strings, meta data column name representing X Y coordinates using spatial data. Default NULL. nCores integer. number cores use Parallel processing. nRep integer. number sampled synthetic null datasets. Default value 1. parallelization string indicating specific parallelization function use. Must one 'mcmapply', 'bpmapply', 'pbmcmapply', corresponds parallelization function package parallel,BiocParallel, pbmcapply respectively. default value 'pbmcmapply'. fastVersion logic value. TRUE, fast approximation used. Default FALSE. ifSparse logic value. high-dimensional data (gene number much larger cell number), sparse correlation estimation used. Default FALSE. corrCut numeric value. cutoff non-zero proportions genes used modelling correlation. BPPARAM MulticoreParam object NULL. parameter parallelization = 'mcmapply' 'pbmcmapply', parameter must NULL. parameter parallelization = 'bpmapply',  parameter must one usePca logic value. Whether use PCA approximation. Default FALSE. nPcs numeric value. Number PCs use usePca=T. Default 200. MulticoreParam object offered package 'BiocParallel. default value NULL. Approximation logic value. high-latitude counting matrix, Approximation can increase speed data generation ensuring accuracy. Note takes effect \"fastVersion=TRUE, Approximation=TRUE\". Default FALSE.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Construct the synthetic null data — constructNull","text":"expression matrix synthetic null data.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Construct the synthetic null data — constructNull","text":"function constructs synthetic null data based target data (real data). input expression matrix (gene cell); user specify distribution, usually Negative Binomial count matrix.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/constructNull.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Construct the synthetic null data — constructNull","text":"","code":"data(exampleCounts) nullData <- constructNull(mat = exampleCounts) #> Error in constructNull(mat = exampleCounts): unused argument (mat = exampleCounts)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/dimPlot.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot reduced-dimensional embeddings for reference and null data — dimPlot","title":"Plot reduced-dimensional embeddings for reference and null data — dimPlot","text":"Generates UMAP (reduced dimension) plot comparing reference dataset one multiple null datasets. Input objects can either Seurat SingleCellExperiment objects. objects internally converted SingleCellExperiment.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/dimPlot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot reduced-dimensional embeddings for reference and null data — dimPlot","text":"","code":"dimPlot(   ref_obj,   null_obj,   color_by = \"seurat_clusters\",   seed = 0,   nrow = NULL,   ncol = NULL )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/dimPlot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot reduced-dimensional embeddings for reference and null data — dimPlot","text":"ref_obj Seurat SingleCellExperiment object representing reference dataset. null_obj single object list objects, either Seurat SingleCellExperiment, representing null datasets. color_by character string specifying cell metadata column used color embedding. Default: \"seurat_clusters\". seed Integer random seed reproducibility. Default: 0. nrow Number rows faceting multiple datasets. Default: NULL. ncol Number columns faceting multiple datasets. Default: NULL.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/dimPlot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot reduced-dimensional embeddings for reference and null data — dimPlot","text":"ggplot object showing embedded reference null datasets.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":null,"dir":"Reference","previous_headings":"","what":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"count matrix 100 genes A549 cell line Tian et al., Nature Methods, 2019.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"","code":"data(\"exampleCounts\")"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"dataset 100 rows (genes) 1256 cols (cells)","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/exampleCounts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A count matrix of 100 genes from the A549 cell line from Tian et al., Nature Methods, 2019. — exampleCounts","text":"corresponding count matrix object","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/findMarkers.html","id":null,"dir":"Reference","previous_headings":"","what":"Find differential markers using ClusterDE — findMarkers","title":"Find differential markers using ClusterDE — findMarkers","text":"Find differential markers using ClusterDE","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/findMarkers.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find differential markers using ClusterDE — findMarkers","text":"","code":"findMarkers(   obj,   ident.1,   ident.2,   nCores = 1,   nRep = 1,   flavour = \"classic\",   spatial = NULL )"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/findMarkers.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find differential markers using ClusterDE — findMarkers","text":"obj Seurat object containing expression data. ident.1 Group identity test group 1. ident.2 Group identity test group 2. nCores Number CPU cores used parallelization. nRep Number null replicates. flavour Either \"classic\" \"pca\"; selects null-construction method. classic: uses default count matrix simulation input. pca: uses PCA approximation simulation input, faster scalable large number replicates needed. spatial vector 2 strings, meta data column name representing X Y coordinates using spatial data. Default NULL.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/findMarkers.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find differential markers using ClusterDE — findMarkers","text":"table DEG results.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/findMarkers.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Find differential markers using ClusterDE — findMarkers","text":"","code":"dummy_obj <- DUMMY #> Error: object 'DUMMY' not found findMarkers(dummy_obj, ident.1 = \"cell_type_1\", ident.2 = \"cell_type_2\") #> Error: object 'dummy_obj' not found"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/logcp10k.html","id":null,"dir":"Reference","previous_headings":"","what":"Log-transformed Counts per 10,000 (logCP10K) — logcp10k","title":"Log-transformed Counts per 10,000 (logCP10K) — logcp10k","text":"Computes per-cell log-transformed counts per 10,000 matrix raw counts.","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/logcp10k.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Log-transformed Counts per 10,000 (logCP10K) — logcp10k","text":"","code":"logcp10k(x, scale.factor = 10000)"},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/logcp10k.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Log-transformed Counts per 10,000 (logCP10K) — logcp10k","text":"x matrix Matrix::dgCMatrix raw counts genes rows cells columns. scale.factor numeric value representing scaling factor total counts per cell (default: 1e4).","code":""},{"path":"https://songdongyuan1994.github.io/ClusterDE/reference/logcp10k.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Log-transformed Counts per 10,000 (logCP10K) — logcp10k","text":"matrix dimensions x, containing log-transformed normalized counts per cell.","code":""}]
